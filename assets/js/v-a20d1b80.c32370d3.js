(self.webpackChunkarch_guide=self.webpackChunkarch_guide||[]).push([[25],{9767:(l,n,t)=>{"use strict";t.r(n),t.d(n,{data:()=>u});const u={key:"v-a20d1b80",path:"/advanced/btrfs.html",title:"Btrfs ä»‹ç»ä¸ç›¸å…³æ“ä½œ",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"Btrfs ä»‹ç»",slug:"btrfs-ä»‹ç»",children:[{level:3,title:"Btrfs çš„å†å²",slug:"btrfs-çš„å†å²",children:[]},{level:3,title:"Btrfs çš„ç‰¹æ€§",slug:"btrfs-çš„ç‰¹æ€§",children:[]},{level:3,title:"Btrfs ä¸å…¶å®ƒæ–‡ä»¶ç³»ç»ŸåŠŸèƒ½æ¯”è¾ƒ",slug:"btrfs-ä¸å…¶å®ƒæ–‡ä»¶ç³»ç»ŸåŠŸèƒ½æ¯”è¾ƒ",children:[]},{level:3,title:"Btrfs æ–‡ä»¶ç³»ç»Ÿæ¶æ„",slug:"btrfs-æ–‡ä»¶ç³»ç»Ÿæ¶æ„",children:[]},{level:3,title:"ç†è§£å†™æ—¶å¤åˆ¶ï¼ˆCoWï¼‰",slug:"ç†è§£å†™æ—¶å¤åˆ¶-cow",children:[]}]},{level:2,title:"Btrfs ç›¸å…³æ“ä½œ",slug:"btrfs-ç›¸å…³æ“ä½œ",children:[]}],filePathRelative:"advanced/btrfs.md",git:{updatedTime:1622911282e3,contributors:[{name:"icekylin",email:"wminid@yeah.net",commits:1}]}}},6648:(l,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>A});var u=t(6252),e=t(601);const m=(0,u.Wm)("h1",{id:"btrfs-ä»‹ç»ä¸ç›¸å…³æ“ä½œ"},[(0,u.Wm)("a",{class:"header-anchor",href:"#btrfs-ä»‹ç»ä¸ç›¸å…³æ“ä½œ"},"#"),(0,u.Uk)(" Btrfs ä»‹ç»ä¸ç›¸å…³æ“ä½œ")],-1),r=(0,u.Wm)("p",null,[(0,u.Wm)("img",{src:e.Z,alt:"Btrfs"})],-1),W=(0,u.Wm)("h2",{id:"btrfs-ä»‹ç»"},[(0,u.Wm)("a",{class:"header-anchor",href:"#btrfs-ä»‹ç»"},"#"),(0,u.Uk)(" Btrfs ä»‹ç»")],-1),d=(0,u.Wm)("p",null,[(0,u.Uk)("Btrfs æ˜¯ä¸€ç§æ–°å‹çš„å†™æ—¶å¤åˆ¶ï¼ˆCoWï¼‰Linux æ–‡ä»¶ç³»ç»Ÿï¼Œå·²ç»å¹¶å…¥å†…æ ¸ä¸»çº¿ã€‚ä½ å¯ä»¥è¯»ä½œ "),(0,u.Wm)("strong",null,"B"),(0,u.Uk)("e"),(0,u.Wm)("strong",null,"t"),(0,u.Uk)("te"),(0,u.Wm)("strong",null,"r"),(0,u.Uk)(),(0,u.Wm)("strong",null,"F"),(0,u.Uk)("ile "),(0,u.Wm)("strong",null,"S"),(0,u.Uk)("ystemã€"),(0,u.Wm)("strong",null,"B"),(0,u.Uk)("-"),(0,u.Wm)("strong",null,"tr"),(0,u.Uk)("ee "),(0,u.Wm)("strong",null,"F"),(0,u.Uk)("ile "),(0,u.Wm)("strong",null,"S"),(0,u.Uk)("ystemã€"),(0,u.Wm)("strong",null,"B"),(0,u.Uk)("u"),(0,u.Wm)("strong",null,"t"),(0,u.Uk)("ter "),(0,u.Wm)("strong",null,"F"),(0,u.Uk)("ile "),(0,u.Wm)("strong",null,"S"),(0,u.Uk)("ystem ç­‰ç­‰ï¼Œéƒ½æ˜¯æ­£ç¡®çš„ã€‚Btrfs åœ¨è®¾è®¡å®ç°é«˜çº§åŠŸèƒ½çš„åŒæ—¶ï¼Œç€é‡äºå®¹é”™ã€ä¿®å¤ä»¥åŠæ˜“äºç®¡ç†ã€‚å®ƒç”± Oracleã€Red Hatã€Fujitsuã€Intelã€SUSEã€STRATO ç­‰ä¼ä¸šå’Œå¼€å‘è€…å…±åŒå¼€å‘ã€‚Btrfs ä»¥ "),(0,u.Wm)("strong",null,"GNU GPL"),(0,u.Uk)(" åè®®æˆæƒï¼ŒåŒæ—¶ä¹Ÿæ¬¢è¿ä»»ä½•äººçš„è´¡çŒ®ã€‚")],-1),i=(0,u.Wm)("h3",{id:"btrfs-çš„å†å²"},[(0,u.Wm)("a",{class:"header-anchor",href:"#btrfs-çš„å†å²"},"#"),(0,u.Uk)(" Btrfs çš„å†å²")],-1),s=(0,u.Wm)("code",null,"2007",-1),a=(0,u.Uk)(" â€”â€” "),o={href:"https://www.oracle.com/cn/index.html",target:"_blank",rel:"noopener noreferrer"},c=(0,u.Uk)("ç”²éª¨æ–‡ï¼ˆOracleï¼‰"),f=(0,u.Uk)(" å®£å¸ƒå¹¶å¼€å§‹ç ”å‘ "),h=(0,u.Wm)("ul",null,[(0,u.Wm)("li",null,"å¯¹æ ‡ ZFSï¼ˆå¼€æºç¤¾åŒºå¯¹ ZFS æ‰€ä½œå‡ºçš„å›åº”ï¼‰")],-1),B=(0,u.uE)("<li><code>2010</code><ul><li>åœ¨ SUSE Linux Enterprise Server 11 SP1ï¼ˆOpenSUSE 11ï¼‰ä¸ŠæŠ€æœ¯é¢„è§ˆ</li><li>Btrfs åœ¨ 2010 å¹´ 10 æœˆæ¨å‡ºçš„ Ubuntu 10.10 ä¸­å¾—åˆ°äº†åº”ç”¨</li></ul></li><li><code>2011</code><ul><li>2011 å¹´ 6 æœˆ 8 æ—¥ï¼Œåœ¨ Fedora å·¥ç¨‹æŒ‡å¯¼å§”å‘˜ä¼šä¼šè®®ä¸Šï¼Œå§”å‘˜ä¼šå†³å®š Fedora 16 å°†ä»¥ Btrfs ä½œä¸ºé»˜è®¤æ–‡ä»¶ç³»ç»Ÿ.</li><li>2011 å¹´ 8 æœˆ 9 æ—¥ï¼ŒFedora æ’¤å›äº†å†³å®šï¼ŒBtrfs ä¸å†ä½œä¸º Fedora 16 é»˜è®¤æ–‡ä»¶ç³»ç»Ÿï¼›åŸå› æ˜¯æ—¶é—´ä¸å……è¶³ï¼Œæ— æ³•è¾¾åˆ°æ”¹å˜é»˜è®¤æ–‡ä»¶ç³»ç»Ÿæ‰€è¦æ»¡è¶³çš„åŸºæœ¬è¦æ±‚</li><li>2011 å¹´ 10 æœˆ 5 æ—¥ï¼ŒFedora 16 æµ‹è¯•ç‰ˆå‘å¸ƒï¼ŒBTRFS å°†åšä¸ºå…¶é»˜è®¤æ–‡ä»¶ç³»ç»Ÿ</li><li>2011 å¹´ 11 æœˆ 8 æ—¥ï¼ŒFedora 16 æ­£å¼ç‰ˆå‘å¸ƒï¼Œé»˜è®¤æ–‡ä»¶ç³»ç»Ÿä¾ç„¶é‡‡ç”¨ ext4ï¼Œå¹¶æœªé‡‡ç”¨é¢„è®¡çš„ Btrfs æ–‡ä»¶ç³»ç»Ÿ</li></ul></li><li><code>2012</code> â€”â€” åœ¨ SUSE Linux Enterprise Server 11 SP2ï¼ˆOpenSUSE 11ï¼‰å¾—åˆ°å®Œæ•´æ”¯æŒ</li><li><code>2014</code> â€”â€” åœ¨ SUSE Linux Enterprise Server 12ï¼ˆOpenSUSE 12ï¼‰ä¸Šä½œä¸ºé»˜è®¤æ–‡ä»¶ç³»ç»Ÿ</li><li><code>2018</code> â€”â€” åœ¨ SUSE Linux Enterprise Server 15ï¼ˆOpenSUSE 15ï¼‰ä¸Šä½œä¸ºé»˜è®¤æ–‡ä»¶ç³»ç»Ÿ</li><li><code>2020</code> â€”â€” 2020 å¹´ 8 æœˆ 24 æ—¥ï¼ŒBtrfs å°†å–ä»£ ext4 ä½œä¸º Fedora 33 ä¸­çš„é»˜è®¤æ–‡ä»¶ç³»ç»Ÿ</li><li><code>2021</code> â€”â€” åœ¨ SUSE MicroOSï¼ˆOpenSUSE MicroOSï¼‰ä¸Šä½œä¸ºé»˜è®¤æ–‡ä»¶ç³»ç»Ÿ</li>",7),k=(0,u.Wm)("h3",{id:"btrfs-çš„ç‰¹æ€§"},[(0,u.Wm)("a",{class:"header-anchor",href:"#btrfs-çš„ç‰¹æ€§"},"#"),(0,u.Uk)(" Btrfs çš„ç‰¹æ€§")],-1),S=(0,u.Wm)("blockquote",null,[(0,u.Wm)("p",null,"å¸¦ âœ… æ ‡è®°çš„æ˜¯æˆ‘ä»¬å¯ä»¥æ„Ÿå—åˆ°çš„")],-1),U=(0,u.Wm)("h4",{id:"æ‰©å±•æ€§ç›¸å…³"},[(0,u.Wm)("a",{class:"header-anchor",href:"#æ‰©å±•æ€§ç›¸å…³"},"#"),(0,u.Uk)(" æ‰©å±•æ€§ç›¸å…³")],-1),b=(0,u.Wm)("ol",null,[(0,u.Wm)("li",null,[(0,u.Uk)("B-tree "),(0,u.Wm)("ul",null,[(0,u.Wm)("li",null,"Btrfs æ–‡ä»¶ç³»ç»Ÿä¸­æ‰€æœ‰çš„ metadata éƒ½ç”± B-tree ç®¡ç†ã€‚ä½¿ç”¨ B-tree çš„ä¸»è¦å¥½å¤„åœ¨äºæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œéƒ½å¾ˆé«˜æ•ˆã€‚å¯ä»¥è¯´ B-tree æ˜¯ Btrfs çš„æ ¸å¿ƒ")])]),(0,u.Wm)("li",null,"åŸºäº Extent çš„æ–‡ä»¶å­˜å‚¨"),(0,u.Wm)("li",null,[(0,u.Uk)("âœ… é’ˆå¯¹ SSD çš„ä¼˜åŒ–æ”¯æŒ "),(0,u.Wm)("ul",null,[(0,u.Wm)("li",null,"Btrfs çš„ CoW æŠ€æœ¯ä»æ ¹æœ¬ä¸Šé¿å…äº†å¯¹åŒä¸€ä¸ªç‰©ç†å•å…ƒçš„åå¤å†™æ“ä½œã€‚å¦‚æœç”¨æˆ·æ‰“å¼€äº† SSD ä¼˜åŒ–é€‰é¡¹ï¼ŒBtrfs å°†åœ¨åº•å±‚çš„å—ç©ºé—´åˆ†é…ç­–ç•¥ä¸Šè¿›è¡Œä¼˜åŒ–ï¼šå°†å¤šæ¬¡ç£ç›˜ç©ºé—´åˆ†é…è¯·æ±‚èšåˆæˆä¸€ä¸ªå¤§å°ä¸º 2M çš„è¿ç»­çš„å—ã€‚å¤§å—è¿ç»­åœ°å€çš„ IO èƒ½å¤Ÿè®©å›ºåŒ–åœ¨ SSD å†…éƒ¨çš„å¾®ä»£ç æ›´å¥½çš„è¿›è¡Œè¯»å†™ä¼˜åŒ–ï¼Œä»è€Œæé«˜ I/O æ€§èƒ½")])]),(0,u.Wm)("li",null,"åŠ¨æ€ Inode åˆ†é…"),(0,u.Wm)("li",null,"æ”¯æŒéå¸¸å¤§çš„å•ä¸ªæ–‡ä»¶å¤§å°")],-1),g=(0,u.Wm)("h4",{id:"æ•°æ®ä¸€è‡´æ€§ç›¸å…³"},[(0,u.Wm)("a",{class:"header-anchor",href:"#æ•°æ®ä¸€è‡´æ€§ç›¸å…³"},"#"),(0,u.Uk)(" æ•°æ®ä¸€è‡´æ€§ç›¸å…³")],-1),p=(0,u.Wm)("ol",null,[(0,u.Wm)("li",null,[(0,u.Uk)("âœ… å†™æ—¶å¤åˆ¶ï¼ˆCoWï¼‰ "),(0,u.Wm)("ul",null,[(0,u.Wm)("li",null,"æ¯”å°±åœ°ä¿®æ”¹çš„æ–‡ä»¶ç³»ç»Ÿæœ‰æ›´å¤§çš„å¥½å¤„ï¼Œè¯¦ç»†çš„è¯´æ˜è§ä¸‹æ–‡")])]),(0,u.Wm)("li",null,[(0,u.Uk)("æ ¡éªŒå’Œï¼ˆChecksumï¼‰ "),(0,u.Wm)("ul",null,[(0,u.Wm)("li",null,"ä¿è¯äº†æ•°æ®çš„å¯é æ€§ï¼šç”±äºç¡¬ä»¶åŸå› ï¼Œä»ç£ç›˜ä¸Šè¯»å‡ºçš„æ•°æ®ä¼šå‡ºé”™ã€‚æ¯”å¦‚ block A ä¸­å­˜æ”¾çš„æ•°æ®ä¸º 0x55ï¼Œä½†è¯»å–å‡ºæ¥çš„æ•°æ®å˜æˆäº† 0x54ï¼Œå› ä¸ºè¯»å–æ“ä½œå¹¶æœªæŠ¥é”™ï¼Œæ‰€ä»¥è¿™ç§é”™è¯¯ä¸èƒ½è¢«ä¸Šå±‚è½¯ä»¶æ‰€å¯Ÿè§‰ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯ä¿å­˜æ•°æ®çš„æ ¡éªŒå’Œï¼Œåœ¨è¯»å–æ•°æ®åæ£€æŸ¥æ ¡éªŒå’Œã€‚å¦‚æœä¸ç¬¦åˆï¼Œä¾¿çŸ¥é“æ•°æ®å‡ºç°äº†é”™è¯¯ã€‚å¦‚æœæœ€ç»ˆä»ç£ç›˜è¯»å–å‡ºæ¥çš„æ•°æ®å’Œ checksum ä¸ç›¸åŒï¼ŒBtrfs ä¼šé¦–å…ˆå°è¯•è¯»å–æ•°æ®çš„é•œåƒå¤‡ä»½ï¼Œå¦‚æœæ•°æ®æ²¡æœ‰é•œåƒå¤‡ä»½ï¼ŒBtrfs å°†è¿”å›é”™è¯¯ã€‚å†™å…¥ç£ç›˜æ•°æ®ä¹‹å‰ï¼ŒBtrfs è®¡ç®—æ•°æ®çš„ checksumã€‚ç„¶åå°† checksum å’Œæ•°æ®åŒæ—¶å†™å…¥ç£ç›˜ã€‚")])])],-1),E=(0,u.Wm)("h4",{id:"å¤šè®¾å¤‡ç®¡ç†ç›¸å…³"},[(0,u.Wm)("a",{class:"header-anchor",href:"#å¤šè®¾å¤‡ç®¡ç†ç›¸å…³"},"#"),(0,u.Uk)(" å¤šè®¾å¤‡ç®¡ç†ç›¸å…³")],-1),x=(0,u.Wm)("ol",null,[(0,u.Wm)("li",null,[(0,u.Uk)("âœ… å¤šè®¾å¤‡ç®¡ç† "),(0,u.Wm)("ul",null,[(0,u.Wm)("li",null,[(0,u.Uk)("Btrfs æ”¯æŒåŠ¨æ€æ·»åŠ è®¾å¤‡ã€‚ç”¨æˆ·åœ¨ç³»ç»Ÿä¸­å¢åŠ æ–°çš„ç£ç›˜ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ "),(0,u.Wm)("code",null,"btrfs"),(0,u.Uk)(" çš„ç›¸å…³å‘½ä»¤å°†è¯¥è®¾å¤‡æ·»åŠ åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­")])])]),(0,u.Wm)("li",null,[(0,u.Uk)("âœ… å­å·ï¼ˆSubvolumeï¼‰ "),(0,u.Wm)("ul",null,[(0,u.Wm)("li",null,"æŠŠæ–‡ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†é…ç½®ä¸ºä¸€ä¸ªå®Œæ•´çš„å­æ–‡ä»¶ç³»ç»Ÿ")])]),(0,u.Wm)("li",null,[(0,u.Uk)("âœ… å¿«ç…§ï¼ˆSnapshotï¼‰å’Œå…‹éš†ï¼ˆCloneï¼‰ "),(0,u.Wm)("ul",null,[(0,u.Wm)("li",null,"æ”¯æŒå¿«ç…§"),(0,u.Wm)("li",null,"æ”¯æŒå¿«ç…§çš„å¿«ç…§ï¼ˆå¢é‡å¤‡ä»½ï¼‰"),(0,u.Wm)("li",null,"å¯ä»¥å¯¹å•ä¸ªæ–‡ä»¶è¿›è¡Œå¤‡ä»½")])]),(0,u.Wm)("li",null,"âœ… å†…ç½®æ”¯æŒ RAIDï¼Œæ”¯æŒæ¡å¸¦æˆ– mirror ç­‰å¸¸è§çš„ RAID åŠŸèƒ½"),(0,u.Wm)("li",null,"âœ… æ”¯æŒçƒ­ç§»é™¤ã€çƒ­æ·»åŠ è®¾å¤‡")],-1),F=(0,u.Wm)("h4",{id:"å…¶ä»–ç‰¹æ€§"},[(0,u.Wm)("a",{class:"header-anchor",href:"#å…¶ä»–ç‰¹æ€§"},"#"),(0,u.Uk)(" å…¶ä»–ç‰¹æ€§")],-1),O=(0,u.Wm)("ol",null,[(0,u.Wm)("li",null,[(0,u.Uk)("âœ… é€æ˜å‹ç¼© "),(0,u.Wm)("ul",null,[(0,u.Wm)("li",null,"å‡å°äº†æ–‡ä»¶çš„å¤§å°ï¼Œé€šè¿‡å‡å°‘æ–‡ä»¶å†™å…¥å¢å¹…æ¥æ˜¾è‘—å»¶é•¿é—ªå­˜ä»‹è´¨çš„å¯¿å‘½ã€‚åœ¨æŸäº›ç‰¹å®šçš„åœºæ™¯ä¸‹ï¼ˆæ¯”å¦‚å•çº¿ç¨‹ã€é‡è´Ÿè·çš„æ–‡ä»¶ I/Oï¼‰è¿˜æé«˜äº†æ€§èƒ½")])]),(0,u.Wm)("li",null,[(0,u.Uk)("å»¶è¿Ÿåˆ†é…ï¼ˆDelay allocationï¼‰ "),(0,u.Wm)("ul",null,[(0,u.Wm)("li",null,"åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå°å—ç©ºé—´é¢‘ç¹çš„åˆ†é…å’Œé‡Šæ”¾ä¼šé€ æˆç¢ç‰‡ã€‚å»¶è¿Ÿåˆ†é…åˆ™æ˜¯è¿™æ ·ä¸€ç§æŠ€æœ¯ â€”â€” å½“ç”¨æˆ·éœ€è¦ç£ç›˜ç©ºé—´æ—¶ï¼Œå…ˆå°†æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚å°†ç£ç›˜åˆ†é…éœ€æ±‚å‘é€ç»™ç£ç›˜ç©ºé—´åˆ†é…å™¨ï¼Œç£ç›˜ç©ºé—´åˆ†é…å™¨å¹¶ä¸ç«‹å³åˆ†é…çœŸæ­£çš„ç£ç›˜ç©ºé—´ã€‚åªæ˜¯è®°å½•ä¸‹è¿™ä¸ªè¯·æ±‚ä¾¿è¿”å›ã€‚ç£ç›˜ç©ºé—´åˆ†é…è¯·æ±‚å¯èƒ½å¾ˆé¢‘ç¹ï¼Œæ‰€ä»¥åœ¨å»¶è¿Ÿåˆ†é…çš„ä¸€æ®µæ—¶é—´å†…ï¼Œç£ç›˜åˆ†é…å™¨å¯ä»¥æ”¶åˆ°å¾ˆå¤šçš„åˆ†é…è¯·æ±‚ â€”â€” ä¸€äº›è¯·æ±‚ä¹Ÿè®¸å¯ä»¥åˆå¹¶ï¼Œä¸€äº›è¯·æ±‚åœ¨è¿™æ®µå»¶è¿ŸæœŸé—´ç”šè‡³å¯èƒ½è¢«å–æ¶ˆã€‚é€šè¿‡è¿™æ ·çš„â€œç­‰å¾…â€ï¼Œå¾€å¾€èƒ½å¤Ÿå‡å°‘ä¸å¿…è¦çš„åˆ†é…ï¼Œä¹Ÿæœ‰å¯èƒ½å°†å¤šä¸ªå°çš„åˆ†é…è¯·æ±‚åˆå¹¶ä¸ºä¸€ä¸ªå¤§çš„è¯·æ±‚ï¼Œä»è€Œæé«˜ I/O æ•ˆç‡")])]),(0,u.Wm)("li",null,[(0,u.Uk)("Inline File "),(0,u.Wm)("ul",null,[(0,u.Wm)("li",null,"ç³»ç»Ÿä¸­å¾€å¾€å­˜åœ¨å¤§é‡çš„å°æ–‡ä»¶ï¼ˆå‡ ç™¾ä¸ªå­—èŠ‚æˆ–è€…æ›´å°ï¼‰ã€‚å¦‚æœä¸ºå…¶åˆ†é…å•ç‹¬çš„æ•°æ® blockï¼Œä¾¿ä¼šå¼•èµ·å†…éƒ¨ç¢ç‰‡ï¼Œæµªè´¹ç£ç›˜ç©ºé—´ã€‚Btrfs å°†å°æ–‡ä»¶çš„å†…å®¹ä¿å­˜åœ¨å…ƒæ•°æ®ä¸­ï¼Œä¸å†é¢å¤–åˆ†é…å­˜æ”¾æ–‡ä»¶æ•°æ®çš„ç£ç›˜å—ã€‚æ”¹å–„äº†å†…éƒ¨ç¢ç‰‡é—®é¢˜ï¼Œä¹Ÿå¢åŠ äº†æ–‡ä»¶çš„è®¿é—®æ•ˆç‡ã€‚å¾—ç›Šäº Inline File æŠ€æœ¯ï¼ŒBtrfs å¤„ç†å°æ–‡ä»¶çš„æ•ˆç‡éå¸¸é«˜ï¼Œä¹Ÿé¿å…äº†ç£ç›˜ç¢ç‰‡é—®é¢˜")])]),(0,u.Wm)("li",null,[(0,u.Uk)("ç›®å½•ç´¢å¼•ï¼ˆDirectory Indexï¼‰ "),(0,u.Wm)("ul",null,[(0,u.Wm)("li",null,"å½“ä¸€ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶æ•°ç›®å·¨å¤§æ—¶ï¼Œç›®å½•ç´¢å¼•å¯ä»¥æ˜¾è‘—æé«˜æ–‡ä»¶æœç´¢æ—¶é—´ã€‚ Btrfs æœ¬èº«é‡‡ç”¨ B-tree å­˜å‚¨ç›®å½•é¡¹ï¼Œæ‰€ä»¥åœ¨ç»™å®šç›®å½•ä¸‹æœç´¢æ–‡ä»¶çš„æ•ˆç‡æ˜¯éå¸¸é«˜çš„ã€‚ç„¶è€Œï¼ŒBtrfs ä½¿ç”¨ B-tree ç®¡ç†ç›®å½•é¡¹çš„æ–¹å¼æ— æ³•åŒæ—¶æ»¡è¶³ readdir çš„éœ€æ±‚ã€‚readdir æ˜¯ POSIX æ ‡å‡† APIï¼Œå®ƒè¦æ±‚è¿”å›æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼›å¹¶ä¸”ç‰¹åˆ«çš„ï¼Œè¿™äº›æ–‡ä»¶è¦æŒ‰ç…§ inode number æ’åºã€‚è€Œ Btrfs ç›®å½•é¡¹æ’å…¥ B-tree æ—¶çš„ Key å¹¶ä¸æ˜¯ inode numberï¼Œè€Œæ˜¯æ ¹æ®æ–‡ä»¶åè®¡ç®—çš„ä¸€ä¸ª hash å€¼ã€‚è¿™ç§æ–¹å¼åœ¨æŸ¥æ‰¾ä¸€ä¸ªç‰¹å®šæ–‡ä»¶æ—¶éå¸¸é«˜æ•ˆï¼Œä½†å´ä¸é€‚äº readdir ã€‚ä¸ºæ­¤ï¼ŒBtrfs åœ¨æ¯æ¬¡åˆ›å»ºæ–°çš„æ–‡ä»¶æ—¶ï¼Œé™¤äº†æ’å…¥ä»¥ hash å€¼ä¸º Key çš„ç›®å½•é¡¹å¤–ï¼Œè¿˜åŒæ—¶æ’å…¥å¦å¤–ä¸€ç§ç›®å½•é¡¹ç´¢å¼•ï¼Œè¯¥ç›®å½•é¡¹ç´¢å¼•çš„ Key ä»¥ sequence number ä½œä¸º B-tree çš„é”®å€¼ã€‚è¿™ä¸ª sequence number åœ¨æ¯æ¬¡åˆ›å»ºæ–°æ–‡ä»¶æ—¶çº¿æ€§å¢åŠ ã€‚å› ä¸º Inode number ä¹Ÿæ˜¯æ¯æ¬¡åˆ›å»ºæ–°æ–‡ä»¶æ—¶å¢åŠ çš„ï¼Œæ‰€ä»¥ sequence number å’Œ inode number çš„é¡ºåºç›¸åŒã€‚ä»¥è¿™ç§ sequence number ä½œä¸º Key åœ¨ B-tree ä¸­æŸ¥æ‰¾ä¾¿å¯ä»¥æ–¹ä¾¿çš„å¾—åˆ°ä¸€ä¸ªä»¥ inode number æ’åºçš„æ–‡ä»¶åˆ—è¡¨"),(0,u.Wm)("li",null,"å¦å¤–ä»¥ sequence number æ’åºçš„æ–‡ä»¶å¾€å¾€åœ¨ç£ç›˜ä¸Šçš„ä½ç½®ä¹Ÿæ˜¯ç›¸é‚»çš„ï¼Œæ‰€ä»¥ä»¥ sequence number ä¸ºåºè®¿é—®å¤§é‡æ–‡ä»¶ä¼šè·å¾—æ›´å¥½çš„ I/O æ•ˆç‡")])]),(0,u.Wm)("li",null,[(0,u.Uk)("é¢„åˆ†é… "),(0,u.Wm)("ul",null,[(0,u.Wm)("li",null,[(0,u.Uk)("å¾ˆå¤šåº”ç”¨ç¨‹åºæœ‰é¢„å…ˆåˆ†é…ç£ç›˜ç©ºé—´çš„éœ€è¦ã€‚ä»–ä»¬å¯ä»¥é€šè¿‡ "),(0,u.Wm)("code",null,"posix_fallocate"),(0,u.Uk)(" æ¥å£å‘Šè¯‰æ–‡ä»¶ç³»ç»Ÿåœ¨ç£ç›˜ä¸Šé¢„ç•™ä¸€éƒ¨åˆ†ç©ºé—´ï¼Œä½†æš‚æ—¶å¹¶ä¸å†™å…¥æ•°æ®ã€‚å¦‚æœåº•å±‚æ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒ "),(0,u.Wm)("code",null,"fallocate"),(0,u.Uk)("ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºåªæœ‰ä½¿ç”¨ "),(0,u.Wm)("code",null,"write"),(0,u.Uk)(" é¢„å…ˆå†™ä¸€äº›æ— ç”¨ä¿¡æ¯ä»¥ä¾¿ä¸ºè‡ªå·±é¢„ç•™è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ã€‚ç”±æ–‡ä»¶ç³»ç»Ÿæ¥æ”¯æŒé¢„ç•™ç©ºé—´æ›´åŠ æœ‰æ•ˆï¼Œè€Œä¸”èƒ½å¤Ÿå‡å°‘ç£ç›˜ç¢ç‰‡ï¼Œå› ä¸ºæ‰€æœ‰çš„ç©ºé—´éƒ½æ˜¯ä¸€æ¬¡åˆ†é…ï¼Œå› è€Œæ›´æœ‰å¯èƒ½ä½¿ç”¨è¿ç»­çš„ç©ºé—´ã€‚ Btrfs æ”¯æŒ "),(0,u.Wm)("code",null,"posix_fallocate")])])])],-1),v=(0,u.Wm)("h3",{id:"btrfs-ä¸å…¶å®ƒæ–‡ä»¶ç³»ç»ŸåŠŸèƒ½æ¯”è¾ƒ"},[(0,u.Wm)("a",{class:"header-anchor",href:"#btrfs-ä¸å…¶å®ƒæ–‡ä»¶ç³»ç»ŸåŠŸèƒ½æ¯”è¾ƒ"},"#"),(0,u.Uk)(" Btrfs ä¸å…¶å®ƒæ–‡ä»¶ç³»ç»ŸåŠŸèƒ½æ¯”è¾ƒ")],-1),I=(0,u.Wm)("table",null,[(0,u.Wm)("thead",null,[(0,u.Wm)("tr",null,[(0,u.Wm)("th",null,"Feature"),(0,u.Wm)("th",null,"Ext 2 / 3"),(0,u.Wm)("th",null,"Ext 4"),(0,u.Wm)("th",null,"ReiserFS"),(0,u.Wm)("th",null,"XFS"),(0,u.Wm)("th",null,"OCFS2"),(0,u.Wm)("th",null,"Btrfs")])]),(0,u.Wm)("tbody",null,[(0,u.Wm)("tr",null,[(0,u.Wm)("td",null,"Journal (date / metadata)"),(0,u.Wm)("td",null,"âš« / âš«"),(0,u.Wm)("td",null,"âš« / âš«"),(0,u.Wm)("td",null,"âšª / âš«"),(0,u.Wm)("td",null,"âšª / âš«"),(0,u.Wm)("td",null,"âšª / âš«"),(0,u.Wm)("td",null,[(0,u.Wm)("strong",null,"N/A")])]),(0,u.Wm)("tr",null,[(0,u.Wm)("td",null,"Journal (internal / external)"),(0,u.Wm)("td",null,"âš« / âš«"),(0,u.Wm)("td",null,"âš« / âš«"),(0,u.Wm)("td",null,"âš« / âš«"),(0,u.Wm)("td",null,"âš« / âš«"),(0,u.Wm)("td",null,"âš« / âšª"),(0,u.Wm)("td",null,"N/A")]),(0,u.Wm)("tr",null,[(0,u.Wm)("td",null,"Offline extend / shrink"),(0,u.Wm)("td",null,"âš« / âš«"),(0,u.Wm)("td",null,"âš« / âš«"),(0,u.Wm)("td",null,"âš« / âš«"),(0,u.Wm)("td",null,"âšª / âšª"),(0,u.Wm)("td",null,"âš« / âšª"),(0,u.Wm)("td",null,"âš« / âš«")]),(0,u.Wm)("tr",null,[(0,u.Wm)("td",null,"Online extend / shrink"),(0,u.Wm)("td",null,"âš« / âšª"),(0,u.Wm)("td",null,"âš« / âšª"),(0,u.Wm)("td",null,"âš« / âšª"),(0,u.Wm)("td",null,"âš« / âšª"),(0,u.Wm)("td",null,"âš« / âšª"),(0,u.Wm)("td",null,"âš« / âš«")]),(0,u.Wm)("tr",null,[(0,u.Wm)("td",null,"Inode allocation map"),(0,u.Wm)("td",null,"table"),(0,u.Wm)("td",null,"table"),(0,u.Wm)("td",null,"B*-tree"),(0,u.Wm)("td",null,"B+-tree"),(0,u.Wm)("td",null,"table"),(0,u.Wm)("td",null,"B-tree")]),(0,u.Wm)("tr",null,[(0,u.Wm)("td",null,"Sparse files"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"âš«")]),(0,u.Wm)("tr",null,[(0,u.Wm)("td",null,"Tail packing"),(0,u.Wm)("td",null,"âšª"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"âšª"),(0,u.Wm)("td",null,"âšª"),(0,u.Wm)("td",null,"âš«")]),(0,u.Wm)("tr",null,[(0,u.Wm)("td",null,"Defragmentation"),(0,u.Wm)("td",null,"âšª"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"âšª"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"âšª"),(0,u.Wm)("td",null,"âš«")]),(0,u.Wm)("tr",null,[(0,u.Wm)("td",null,"ExtArributes / ACLs"),(0,u.Wm)("td",null,"âš« / âš«"),(0,u.Wm)("td",null,"âš« / âš«"),(0,u.Wm)("td",null,"âš« / âš«"),(0,u.Wm)("td",null,"âš« / âš«"),(0,u.Wm)("td",null,"âš« / âš«"),(0,u.Wm)("td",null,"âš« / âš«")]),(0,u.Wm)("tr",null,[(0,u.Wm)("td",null,"Quotas"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"ğŸ”´")]),(0,u.Wm)("tr",null,[(0,u.Wm)("td",null,"Dump / restore"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"âšª"),(0,u.Wm)("td",null,"âš«"),(0,u.Wm)("td",null,"âšª"),(0,u.Wm)("td",null,"âšª")]),(0,u.Wm)("tr",null,[(0,u.Wm)("td",null,"Default block size"),(0,u.Wm)("td",null,"4 KiB"),(0,u.Wm)("td",null,"4 KiB"),(0,u.Wm)("td",null,"4 KiB"),(0,u.Wm)("td",null,"4 KiB"),(0,u.Wm)("td",null,"4 KiB"),(0,u.Wm)("td",null,"4 KiB")]),(0,u.Wm)("tr",null,[(0,u.Wm)("td",null,"max. file system size"),(0,u.Wm)("td",null,"16 TiB"),(0,u.Wm)("td",null,"1 EiB"),(0,u.Wm)("td",null,"16 TiB"),(0,u.Wm)("td",null,"8 EiB"),(0,u.Wm)("td",null,"4 PiB"),(0,u.Wm)("td",null,[(0,u.Wm)("strong",null,"16 EiB")])]),(0,u.Wm)("tr",null,[(0,u.Wm)("td",null,"max. file size"),(0,u.Wm)("td",null,"2 TiB"),(0,u.Wm)("td",null,"1 EiB"),(0,u.Wm)("td",null,"1 EiB"),(0,u.Wm)("td",null,"8 EiB"),(0,u.Wm)("td",null,"4 PiB"),(0,u.Wm)("td",null,[(0,u.Wm)("strong",null,"16 EiB")])]),(0,u.Wm)("tr",null,[(0,u.Wm)("td",null,"Support status"),(0,u.Wm)("td",null,"SLES"),(0,u.Wm)("td",null,"SLES"),(0,u.Wm)("td",null,"SLES"),(0,u.Wm)("td",null,"SLES"),(0,u.Wm)("td",null,"SLE HA"),(0,u.Wm)("td",null,"SLES")])])],-1),y=(0,u.Wm)("h3",{id:"btrfs-æ–‡ä»¶ç³»ç»Ÿæ¶æ„"},[(0,u.Wm)("a",{class:"header-anchor",href:"#btrfs-æ–‡ä»¶ç³»ç»Ÿæ¶æ„"},"#"),(0,u.Uk)(" Btrfs æ–‡ä»¶ç³»ç»Ÿæ¶æ„")],-1),L=(0,u.Wm)("h3",{id:"ç†è§£å†™æ—¶å¤åˆ¶-cow"},[(0,u.Wm)("a",{class:"header-anchor",href:"#ç†è§£å†™æ—¶å¤åˆ¶-cow"},"#"),(0,u.Uk)(" ç†è§£å†™æ—¶å¤åˆ¶ï¼ˆCoWï¼‰")],-1),C=(0,u.Wm)("h2",{id:"btrfs-ç›¸å…³æ“ä½œ"},[(0,u.Wm)("a",{class:"header-anchor",href:"#btrfs-ç›¸å…³æ“ä½œ"},"#"),(0,u.Uk)(" Btrfs ç›¸å…³æ“ä½œ")],-1),w=(0,u.Wm)("blockquote",null,[(0,u.Wm)("p",null,"ğŸ“” æœ¬èŠ‚å‚è€ƒèµ„æ–™ï¼š"),(0,u.Wm)("p",null,"éƒ¨åˆ†èµ„æ–™æ¥è‡ªäº’è”ç½‘ï¼ˆç”±äºæ— æ³•ç¡®è®¤åŸä½œè€…ï¼Œå‡ºå¤„æœ‰å¾…ç¡®è®¤ï¼‰")],-1),A={render:function(l,n){const t=(0,u.up)("OutboundLink");return(0,u.wg)(),(0,u.j4)(u.HY,null,[m,r,W,d,i,(0,u.Wm)("ul",null,[(0,u.Wm)("li",null,[s,a,(0,u.Wm)("a",o,[c,(0,u.Wm)(t)]),f,h]),B]),k,S,U,b,g,p,E,x,F,O,v,I,y,L,C,w],64)}}},601:(l,n,t)=>{"use strict";t.d(n,{Z:()=>u});const u=t.p+"assets/img/btrfs-logo.659fa8d1.svg"}}]);